<include file = "Common/header" />
<div class="am-cf admin-main">
    <include file = "Common/left" />


    <!-- content start -->
    <div class="admin-content">
        <div class="admin-content-body">
            <div class="am-cf am-padding">
                <div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">问题反馈</strong> / <small>matter</small>
                </div>
            </div>
            <div class="am-g">
                <div class="am-u-sm-12 am-u-md-6">
                    <div class="am-btn-toolbar">
                        <div class="am-btn-group am-btn-group-xs">
                            <button type="button" class="am-btn am-btn-warning" id="feedback"><span class="am-icon-plus"></span> 反馈新问题</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="am-g">
                <div class="am-u-sm-12">
                    <form class="am-form">
                        <table class="am-table am-table-striped am-table-hover table-main">
                            <thead>
                            <tr>
                                <th class="table-id" style="width:15%">编号</th>
                                <th class="table-title" style="width:25%">标题</th>
                                <th class="table-type" style="width:20%">类别</th>
                                <th class="table-author am-hide-sm-only" style="width:20%">状态</th>
                                <th class="table-date am-hide-sm-only" style="width:20%">最后更新</th>
                            </tr>
                            </thead>
                            <tbody>
                                <foreach name="msg_list" item="vo" >
                                    <tr>
                                        <td>{$vo.id}</td>
                                        <td><a href="#">{$vo.title}</a></td>
                                        <td>
                                            <switch name="vo.mtype">
                                                <case value="1">意见建议</case>
                                                <case value="2">奖金问题</case>
                                                <case value="3">帐号问题</case>
                                                <case value="3">其他问题</case>
                                                <default />
                                            </switch>
                                        </td>
                                        <td class="am-hide-sm-only">
                                            状态                                           
                                        </td>
                                        <td class="am-hide-sm-only">{$vo.updatetime}</td>
                                        <td>
                                            <div class="am-btn-toolbar">
                                                <div class="am-btn-group am-btn-group-xs">
                                                    <button class="am-btn am-btn-default am-btn-xs am-text-secondary"><span class="am-icon-pencil-square-o"></span> 编辑</button>
                                                    <button class="am-btn am-btn-default am-btn-xs am-hide-sm-only"><span class="am-icon-copy"></span> 复制</button>
                                                    <button class="am-btn am-btn-default am-btn-xs am-text-danger am-hide-sm-only"><span class="am-icon-trash-o"></span> 删除</button>
                                                </div>
                                            </div>
                                        </td>
                                    </tr> 
                                </foreach>
                                
                            </tbody>
                        </table>
                        <div class="am-cf">
                            共 {$count} 条记录
                            <div class="am-fr" id="page" pages = "{$pages}">
                               <!--  <ul class="am-pagination">
                                    <li class="am-disabled"><a href="#">«</a></li>
                                    <li class="am-active"><a href="#">1</a></li>
                                    <li><a href="#">2</a></li>
                                    <li><a href="#">3</a></li>
                                    <li><a href="#">4</a></li>
                                    <li><a href="#">5</a></li>
                                    <li><a href="#">»</a></li>
                                </ul> -->
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <footer class="admin-content-footer">
            <hr>
            <p class="am-padding-left">© 2014 AllMobilize, Inc. Licensed under MIT license.</p>
        </footer>
    </div>
    <!-- content end -->

</div>

<a href="#" class="am-icon-btn am-icon-th-list am-show-sm-only admin-menu" data-am-offcanvas="{target: '#admin-offcanvas'}">
</a>

<include file = "Common/footer" />
<script type="text/javascript">
    $('#feedback').on('click',function(){
        var content = '<div class="am-g" id="couple">'
            content+= '<div class="am-u-12">'
            content+= '        <form class="am-form">'
            content+= '          <fieldset>'
            content+= '            <legend>问题反馈</legend>'
            content+= '            <div class="am-form-group">'
            content+= '              <label for="doc-ipt-pwd-1">信息标题</label>'
            content+= '              <input type="text" name="title" class="" id="doc-ipt-pwd-1" placeholder="请输入您的反馈问题简介">'
            content+= '            </div>'
            content+= '            <div class="am-form-group">'
            content+= '              <label for="doc-select-1">信息分类</label>'
            content+= '              <select id="doc-select-1" name="mtype">'
            content+= '                <option value="1">意见反馈</option>'
            content+= '                <option value="2">奖金问题</option>'
            content+= '                <option value="3">帐号问题</option>'
            content+= '                <option value="4">其他问题</option>'
            content+= '              </select>'
            content+= '              <span class="am-form-caret"></span>'
            content+= '            </div>'
            content+= '            <div class="am-form-group">'
            content+= '              <label for="doc-ta-1">反馈内容</label>'
            content+= '              <textarea class=""  name="msg" rows="5" id="doc-ta-1"></textarea>'
            content+= '            </div>'
            content+= '          </fieldset>'
            content+= '        </form>'
            content+= '    </div>'
            content+= '</div>'
        layer.open({
              type: 1,
              title:'问题反馈',
              area: ['420px',''], //宽高
              content: content,
              btn: ['提交', '取消'],
              yes:function(){
                     var title = $('input[name="title"]').val();
                     var mtype = $('#doc-select-1 option:selected').val();
                     var msg = $('#doc-ta-1').val();
                     if (!title) {
                         layer.alert('请输入标题', {icon: 2});
                         return false;
                     };
                     if (!msg) {
                         layer.alert('请输入反馈问题', {icon: 2});
                         return false;
                     };
                     $.ajax({
                         type:'POST',
                         url:'deal',
                         data:{
                            title:title,
                            mtype:mtype,
                            msg:msg,
                            type:'add',
                         },
                         success:function(data){
                            if (!data.status) {
                                layer.alert(data.info, {icon: 1});
                                return false;
                            };
                            layer.open({
                                  content: data.info,
                                  yes: function(index, layero){
                                     location.reload();
                                  }
                            });   
                         }
                     })
              },
        });
    })
    laypage({
        cont: $('#page'), //容器。值支持id名、原生dom对象，jquery对象,
        pages: $('#page').attr('pages'), //总页数
        //first:false,
        skin: '#AF0000',
        groups: 7,//连续显示分页数
        curr: function(){ //通过url获取当前页，也可以同上（pages）方式获取
            var page = location.search.match(/page=(\d+)/);
            return page ? page[1] : 1;
        }(), 
        jump: function(e, first){ //触发分页后的回调
            if(!first){ //一定要加此判断，否则初始时会无限刷新
                location.href = '?page='+e.curr;
            }
        }
    });
</script>